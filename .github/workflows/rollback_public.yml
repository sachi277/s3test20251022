name: âª ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—åŒæœŸæ–¹å¼ã«ã‚ˆã‚‹åˆ‡ã‚Šæˆ»ã—

on:
  workflow_dispatch:
    inputs:
      reason:
        description: 'åˆ‡ã‚Šæˆ»ã—ç†ç”±'
        required: true
        default: 'ç·Šæ€¥ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯'

jobs:
  rollback:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: read

    steps:
      - name: âš™ï¸ AWSèªè¨¼æƒ…å ±ã®è¨­å®š (OIDC)
        uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: ${{ secrets.AWS_ROLE_TO_ASSUME }}
          aws-region: ${{ secrets.AWS_REGION }}

      - name: â†©ï¸ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å…¬é–‹ãƒã‚±ãƒƒãƒˆã¸ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å¾©å…ƒ
        run: |
          echo "ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒã‚±ãƒƒãƒˆ (${{ secrets.BACKUP_BUCKET }}) ã®å†…å®¹ã§å…¬é–‹ãƒã‚±ãƒƒãƒˆã‚’ä¸Šæ›¸ãã—ã¾ã™ã€‚"
          # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒã‚±ãƒƒãƒˆã®å†…å®¹ã‚’PUBLICãƒã‚±ãƒƒãƒˆã¸åŒæœŸ (åˆ‡ã‚Šæˆ»ã—)
          aws s3 sync s3://${{ secrets.BACKUP_BUCKET }} s3://${{ secrets.PUBLIC_BUCKET }} --delete
      
      # - name: ğŸ’¨ CloudFrontã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ç„¡åŠ¹åŒ–
      #   if: success()
      #   run: |
      #     aws cloudfront create-invalidation --distribution-id ${{ secrets.CLOUDFRONT_DISTRIBUTION_ID }} --paths "/*"
